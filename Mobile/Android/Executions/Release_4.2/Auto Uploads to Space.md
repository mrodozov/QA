#### Auto uploads to spaces


**PR**: [https://github.com/owncloud/android/pull/4214](https://github.com/owncloud/android/pull/4214)

Server(s): 10.13.3, oCIS 4.0<br>
Device(s): Pixel2, Android11. Samsung A8 Android13<br>
Execution date: 24/11/2023<br>
Tester: jrecio<br>
Context: <br>


| Test Case | Steps | Expected Result | Result | Related Comment |
| :-------- | :---- | :-------------- | :----: | :------- |
|**Auto uploads Pictures**|Preconditions:<br> 1. Enable `Picture Uploads`<br>2. Set the correct `Camera folder` with the picture container from the camera app|||||
| oC10 account shows list | 1. With oC10 account in device, click on `Account to upload pictures`<br>2. Select the oC10 account to upload pictures<br>3. Click on `Picture upload path` | List of files displayed | P t13 |  |
| oCIS account shows spaces | 1. With oCIS account in device, click on `Account to upload pictures`<br>2. Select the oCIS account to upload pictures<br>3. Click on `Picture upload path` | List of available spaces displayed | P m11 |  |
| oC10 - oCIS Path switching | 1. Add two accounts to the device, one oCIS and one oC10<br>2. Select oC10 as `Account to upload Pictures` and a `Picture upload Path` inside<br>3. Select oCIS account as `Account to upload Pictures`<br>4. Select oC10 account as `Account to upload Pictures`| 3. `Picture upload Path` reseted to `Personal: /CameraUpload`<br>4. `Picture upload Path` reseted to `/CameraUpload` | P m11 m13 | FIXED: [link](https://github.com/owncloud/android/pull/4214#issuecomment-1825622373)  |
| oC10 Path | 1. in oC10 account, click on `Picture upload path`<br>2. Select a different folder to root, in order to upload pictures in the oC10 account<br>3. Close the app<br>4. Take some pictures with the camera | With the app closed, check in web or another client that the taken pictures were uploaded in 15 minutes to the correct folder | P t13  |  |
| oCIS Personal | 1. in oCIS account, click on `Picture upload path`<br>2. Select Personal space<br>3. Select a different folder to root, in order to upload pictures in the oCIS account<br>4. Close the app<br>5. Take some pictures with the camera | 3. Space + path in screen<br>5. With the app closed, check in web or another client that the taken pictures were uploaded in 15 minutes to the correct folder | P m11 |  |
| oCIS Custom | 1. in oCIS account, click on `Picture upload path`<br>2. Select space that is not personal<br>3. Select a different folder to root, in order to upload pictures in the oCIS account<br>4. Close the app<br>5. Take some pictures with the camera | 3. Space + path in screen<br>5. With the app closed, check in web or another client that the taken pictures were uploaded in 15 minutes to the correct folder | P m11 |  |
|**Auto uploads Videos**|Preconditions:<br> 1. Enable `Video Uploads`<br>2. Set the correct `Camera folder` with the picture container from the camera app|||||
| oC10 account shows list | 1. With oC10 account in device, click on `Account to upload pictures`<br>2. Select the oC10 account to upload videos<br>3. Click on `Video upload path` | List of files displayed | P t13 |  |
| oCIS account shows spaces | 1. With oCIS account in device, click on `Account to upload videos`<br>2. Select the oCIS account to upload videos<br>3. Click on `Video upload path` | List of available spaces displayed | P m11 |  |
| oC10 - oCIS Path switching | 1. Add two accounts to the device, one oCIS and one oC10<br>2. Select oC10 as `Account to upload Pictures` and a `Picture upload Path` inside<br>3. Select oCIS account as `Account to upload Pictures`<br>4. Select oC10 account as `Account to upload Pictures`| 3. `Picture upload Path` reseted to `Personal: /CameraUpload`<br>4. `Picture upload Path` reseted to `/CameraUpload` | P m11 t13 | FIXED: [link](https://github.com/owncloud/android/pull/4214#issuecomment-1825622373) |
| oC10 Path | 1. in oC10 account, click on `Video upload path`<br>2. Select a different folder to root, in order to upload videos in the oC10 account<br>3. Close the app<br>4. Take some videos with the camera | With the app closed, check in web or another client that the taken videos were uploaded in 15 minutes to the correct folder | P t13 |  |
| oCIS Personal | 1. in oCIS account, click on `Video upload path`<br>2. Select Personal space<br>3. Select a different folder to root, in order to upload videos in the oCIS account<br>4. Close the app<br>5. Take some videos with the camera | 3. Space + path in screen<br>5. With the app closed, check in web or another client that the taken videos were uploaded in 15 minutes to the correct folder | P m11 |  |
| oCIS Custom | 1. in oCIS account, click on `Video upload path`<br>2. Select space that is not personal<br>3. Select a different folder to root, in order to upload videos in the oCIS account<br>4. Close the app<br>5. Take some videos with the camera | 3. Space + path in screen<br>5. With the app closed, check in web or another client that the taken videos were uploaded in 15 minutes to the correct folder | P m11 |  |
|**Errors**|  Preconditions:<br> 1. Enable `Video Uploads` or `Photo Uploads`<br>2. Set the correct `Camera folder` with the picture container from the camera app
| Removed folder | 1. In file list, remove folder selected in `Picture upload path` section in `Auto Upload`<br>2. Take pictures/videos and wait 15 min | Removed folder is created again and contains the taken pictures/videos | P m11 |  |
| Account disabled | 1. In server, disable login(oCIS) or disable account(oC10) that is selected in `Account to upload pictures/videos` section in `Auto Upload`<br>2. Take pictures/videos and wait 15 min | Error: `Credentials error` | P t13 |  |
| Account removed | 1. In server, remove account that is selected in `Account to upload pictures/videos` section in `Auto Upload`<br>2. Take pictures/videos and wait 15 min | Error: `Credentials error` | P m11 |  |
| No permissions (oC10) | 1. In oC10 server, share a folder with another user, removing edit permissions<br>2. Sharee sets that folder as target for auto uploads | Not posible, folder without writing permissions is not selectable| P t13 | |
| No permissions (oCIS) | 1. In oCIS server, share a space with a member, removing edit permissions (just read)<br>2. Sharee sets that folder as target for auto uploads | Not posible, folder without writing permissions is not selectable| P m11| |
| Permissions removed (oC10) | 1. In oC10 server, share a folder with another user, granting all permissions<br>2. Sharee sets that folder as target for auto uploads<br>3. Sharing user revokes edit permission (sharee can not upload anymore)<br>4. Take pictures/videos and wait 15 min | Error: `Permission error`| P m13 | |
| Permissions removed (oCIS) | 1. In oCIS server, share a space with another user, granting all permissions<br>2. Sharee sets that folder as target for auto uploads<br>3. Sharing user revokes edit permission (sharee can not upload anymore)<br>4. Take pictures/videos and wait 15 min | Error: `Permission error`| P m13 | |
| Space dislabled (oCIS) | 1. In oCIS server, share a space with another user, granting all permissions<br>2. Sharee sets that folder as target for auto uploads<br>3. Sharing user disables the space<br>4. Take pictures/videos and wait 15 min | Error: `Conflict` | P m13 t13 | Server returns `409 Conflict` |
|**Migration**|
| Migration | 1. Install previous version<br>2. Add oC10 account and oCIS account<br>3. Add oC10 account to `Photo Uploads` and oCIS to `Video Uploads`<br>4. Set a folder that is not root and not the default one in both Pictures and Videos<br>5. Upgrade to current version | Picture and Video uploads showing correct path<br>oCIS account showing `Personal: <path>` | P m11 |  |
| Migration with disabled uploads | 1. Install previous version<br>2. Add oC10 account and oCIS account<br>3. Keep both `Photo Uploads`  and  `Video Uploads` disabled<br>4. Upgrade to current version | Picture and Video uploads stay disabled | P m11 | |
